From 1ee5e1268e3a02b8e8c4fe829fd6529f6b14ea23 Mon Sep 17 00:00:00 2001
From: Holman Romero <holman.romero@sourcefabric.org>
Date: Thu, 31 Jan 2013 17:49:36 +0100
Subject: [PATCH] CS-4563: User editing in back-end allows for cross-site
 scripting

Cast user id parameter to int.
Cast language id parameter to int and fixes error on not found language.
---
 .../modules/admin/controllers/LanguagesController.php         | 11 ++++++++---
 .../application/modules/admin/controllers/UserController.php  |  2 +-
 2 files changed, 9 insertions(+), 4 deletions(-)

diff --git a/newscoop/application/modules/admin/controllers/LanguagesController.php b/newscoop/application/modules/admin/controllers/LanguagesController.php
index 01ea1e212e..3b665e083d 100644
--- a/newscoop/application/modules/admin/controllers/LanguagesController.php
+++ b/newscoop/application/modules/admin/controllers/LanguagesController.php
@@ -120,11 +120,16 @@ public function deleteAction()
      */
     private function getLanguage()
     {
-        $id = $this->getRequest()->getParam('language');
-        $language = $this->repository->find($id);
+        $id = (int) $this->getRequest()->getParam('language');
+        if (!$id) {
+            $this->_helper->flashMessenger(array('error', getGS('Language id not specified')));
+            $this->_helper->redirector('index');
+        }
+
+        $language = $this->repository->findOneBy(array('id' => $id));
         if (empty($language)) {
             $this->_helper->flashMessenger->addMessage(getGS('Language not found.'));
-            $this->_forward('index');
+            $this->_helper->redirector('index');
         }
 
         return $language;
diff --git a/newscoop/application/modules/admin/controllers/UserController.php b/newscoop/application/modules/admin/controllers/UserController.php
index e8e17523d3..cf170def06 100644
--- a/newscoop/application/modules/admin/controllers/UserController.php
+++ b/newscoop/application/modules/admin/controllers/UserController.php
@@ -281,7 +281,7 @@ public function editPasswordAction()
      */
     protected function getUser()
     {
-        $id = $this->_getParam('user', false);
+        $id = (int) $this->_getParam('user', false);
         if (!$id) {
             $this->_helper->flashMessenger(array('error', getGS('User id not specified')));
             $this->_helper->redirector('index');
