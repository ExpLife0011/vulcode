From ed7365064c189b8f136a9f952062249167d1bd9e Mon Sep 17 00:00:00 2001
From: Jamie Cameron <jcameron@webmin.com>
Date: Tue, 10 Jul 2012 10:29:44 -0700
Subject: [PATCH] Prevent passing in of monitor type that could contain invalid
 characters
 https://sourceforge.net/tracker/index.php?func=detail&aid=3542038&group_id=17457&atid=117457#

---
 status/edit_mon.cgi | 1 +
 status/lang/en      | 1 +
 status/save_mon.cgi | 1 +
 3 files changed, 3 insertions(+)

diff --git a/status/edit_mon.cgi b/status/edit_mon.cgi
index cda0c648d..1233edc30 100755
--- a/status/edit_mon.cgi
+++ b/status/edit_mon.cgi
@@ -9,6 +9,7 @@ $access{'edit'} || &error($text{'mon_ecannot'});
 @handlers = &list_handlers();
 if ($in{'type'}) {
 	# Create a new monitor
+	$in{'type'} =~ /^[a-zA-Z0-9\_\-\.]+$/ || &error($text{'mon_etype'});
 	$type = $in{'type'};
 	$title = $text{'mon_create'};
 	if ($in{'clone'}) {
diff --git a/status/lang/en b/status/lang/en
index 968ff905c..1a4d5ae9c 100644
--- a/status/lang/en
+++ b/status/lang/en
@@ -104,6 +104,7 @@ mon_eremote2=Webmin server $1 could not be contacted : $2
 mon_estatus=Webmin server $1 does not have the System and Server Status module
 mon_ecannot=You are not allowed to edit monitors
 mon_ertype=This monitor type is not available on $1
+mon_etype=Invalid monitor type name
 mon_runon=Run commands on
 mon_runon0=This server
 mon_runon1=The remote host
diff --git a/status/save_mon.cgi b/status/save_mon.cgi
index 9579fd5b8..7444e91d3 100755
--- a/status/save_mon.cgi
+++ b/status/save_mon.cgi
@@ -6,6 +6,7 @@ require './status-lib.pl';
 $access{'edit'} || &error($text{'mon_ecannot'});
 &ReadParse();
 if ($in{'type'}) {
+	$in{'type'} =~ /^[a-zA-Z0-9\_\-\.]+$/ || &error($text{'mon_etype'});
 	$serv->{'type'} = $in{'type'};
 	$serv->{'id'} = time();
 	}
