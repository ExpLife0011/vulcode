From 6212bc954d72caf591e141ca36b8df964387bee8 Mon Sep 17 00:00:00 2001
From: Stefan-ST <mybbcms@yahoo.de>
Date: Wed, 20 Nov 2013 14:45:41 +0100
Subject: [PATCH] Fixes XSS in misc.php

---
 misc.php | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/misc.php b/misc.php
index eff5be2d1..c00dd9f3c 100644
--- a/misc.php
+++ b/misc.php
@@ -486,7 +486,7 @@
 	$smilies = '';
 	if($mybb->input['popup'])
 	{ // make small popup list of smilies
-		$editor = addslashes(htmlentities($mybb->input['editor']));
+		$editor = preg_replace('#([^a-zA-z0-9_-]+)#', '', $mybb->input['editor']);
 		$e = 1;
 		$class = "trow1";
 		$smilies = "<tr>";
