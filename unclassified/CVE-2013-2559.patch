From 6c8aa4e9c810994f7632837487426867ce50f468 Mon Sep 17 00:00:00 2001
From: Brendan Abbott <brendan@bloodbone.ws>
Date: Wed, 20 Mar 2013 23:02:43 +1000
Subject: [PATCH] Fix potential autheticated SQL injection attack on the
 Authors page

---
 symphony/lib/toolkit/class.authormanager.php | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/symphony/lib/toolkit/class.authormanager.php b/symphony/lib/toolkit/class.authormanager.php
index 37a8e6c4d..d07df76c2 100755
--- a/symphony/lib/toolkit/class.authormanager.php
+++ b/symphony/lib/toolkit/class.authormanager.php
@@ -90,6 +90,8 @@ public static function delete($id) {
 		 *  An array of Author objects. If no Authors are found, an empty array is returned.
 		 */
 		public static function fetch($sortby = 'id', $sortdirection = 'ASC', $limit = null, $start = null, $where = null, $joins = null) {
+			$sortby = is_null($sortby) ? 'id' : Symphony::Database()->cleanValue($sortby);
+			$sortdirection = $sortdirection === 'ASC' ? 'ASC' : 'DESC';
 
 			$records = Symphony::Database()->fetch(sprintf("
 					SELECT a.*
@@ -101,7 +103,7 @@ public static function fetch($sortby = 'id', $sortdirection = 'ASC', $limit = nu
 				",
 				$joins,
 				($where) ? $where : 1,
-				'a.'.$sortby, $sortdirection,
+				'a.'. $sortby, $sortdirection,
 				($limit) ? "LIMIT " . $limit : '',
 				($start && $limit) ? ', ' . $start : ''
 			));
