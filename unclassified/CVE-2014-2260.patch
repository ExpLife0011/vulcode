From 3270fd1d78391bb847b4c9ce37cf921f485b1310 Mon Sep 17 00:00:00 2001
From: Eugene Pankov <john.pankov@gmail.com>
Date: Wed, 15 Jan 2014 22:25:56 +0300
Subject: [PATCH] [ui] fixes

---
 ajenti/plugins/main/content/js/ajenti.coffee           | 8 ++++++--
 ajenti/plugins/main/content/js/controls.binding.coffee | 3 ++-
 ajenti/plugins/main/content/js/controls.inputs.coffee  | 2 +-
 3 files changed, 9 insertions(+), 4 deletions(-)

diff --git a/ajenti/plugins/main/content/js/ajenti.coffee b/ajenti/plugins/main/content/js/ajenti.coffee
index 5844a063..bb8d7e41 100644
--- a/ajenti/plugins/main/content/js/ajenti.coffee
+++ b/ajenti/plugins/main/content/js/ajenti.coffee
@@ -322,8 +322,12 @@ class window.Control
         
         
     s: (value) ->
-        # TODO SANITIZE!
-        value
+        ('' + value) /* Forces the conversion to string. */
+        .replace(/&/g, '&amp;') /* This MUST be the 1st replacement. */
+            .replace(/'/g, '&apos;') /* The 4 other predefined entities, required. */
+            .replace(/"/g, '&quot;')
+            .replace(/</g, '&lt;')
+            .replace(/>/g, '&gt;')
 
     createDom: () ->
         ""
diff --git a/ajenti/plugins/main/content/js/controls.binding.coffee b/ajenti/plugins/main/content/js/controls.binding.coffee
index 9f127b87..e0f0f0eb 100644
--- a/ajenti/plugins/main/content/js/controls.binding.coffee
+++ b/ajenti/plugins/main/content/js/controls.binding.coffee
@@ -6,4 +6,5 @@ class window.Controls.bind__template extends window.Control
     setupDom: (dom) ->
         super(dom)
         if @children.length > 0
-            @dom = @children[0].dom
\ No newline at end of file
+            @dom = @children[0].dom
+            @properties = @children[0].properties
\ No newline at end of file
diff --git a/ajenti/plugins/main/content/js/controls.inputs.coffee b/ajenti/plugins/main/content/js/controls.inputs.coffee
index a36c1536..89a392b1 100644
--- a/ajenti/plugins/main/content/js/controls.inputs.coffee
+++ b/ajenti/plugins/main/content/js/controls.inputs.coffee
@@ -231,7 +231,7 @@ class window.Controls.fileupload extends window.Control
         super(dom)        
         @progress = new window.Controls.progressbar(@ui, {}, [])
         $(@dom).find('.pb').append($(@progress.dom))
-        @input = @dom.find('input')[0]
+        @input = $(@dom).find('input')[0]
         @input.addEventListener 'change', (e) =>
             file = @input.files[0]
             xhr = new XMLHttpRequest()
